#!/bin/sh

DIR="$1"
TEST="$2"
TMPDIR="test/.${TEST}.tmp"

echo ""
echo "----------------------------------------------------------------------------------------------------"
echo " Running test ${TEST}"
echo "----------------------------------------------------------------------------------------------------"

rm -fr "$TMPDIR"
cp -r "$DIR/$TEST" "$TMPDIR"
cd "$TMPDIR"
set -v
source ./script 2>&1 | tee output
set +v

echo "----------------------------------------------------------------------------------------------------"
diff output check
SUCCESS=$?
[ $SUCCESS = 0 ] && echo " [PASS] ${TEST}" && rm -f "../$TEST.log" || (
    echo "----------------------------------------------------------------------------------------------------"
    echo " [FAIL] ${TEST}" && mv output "../$TEST.log"
  )
echo "----------------------------------------------------------------------------------------------------"
cd ..
rm -fr "$TMPDIR"
exit $SUCCESS
